{% extends "front/base.html" %}
{% load staticfiles repository_tags %}
{% static 'front/img/default-avatar.png' as default_avatar %}

{% block body_classes %}repository{% endblock %}
{% block body_attributes %} data-repository={{ current_repository.full_name }} data-repository-id={{ current_repository.id }}{% endblock %}
{% block title %}{{ current_repository }} | {{ view.name }}{% endblock title %}

{% block header_nav %}
    <ul class="nav">
        <li class="dropdown">
            <a id="repository-switcher" href="#" role="button" class="dropdown-toggle" data-toggle="dropdown">{{ current_repository }} <b class="caret"></b></a>
            {% regroup subscribed_repositories by owner as groups %}
            <ul class="dropdown-menu" id="repository-switcher-content" role="menu" aria-labelledby="repository-switcher">
                <li>
                    {% include "front/include_quicksearch.html" with id="repository-switcher-filter" target="#repository-switcher-content li.subscriptions-group, #repository-switcher-content li.subscriptions-group li" only %}
                </li>
                {% for group in groups %}
                    <li class="subscriptions-group">
                        <strong>
                            <img class="avatar-micro img-circle" src="{{ group.grouper.avatar_url|default:default_avatar }}" />
                            {{ group.grouper.username }}
                        </strong>
                        <ul class="unstyled">
                            {% for repository in group.list %}
                                <li{% if repository.id == current_repository.id %} class="active"{% endif %}><a role="menuitem" href="{{ repository.get_absolute_url }}"><span>{{ group.grouper.username }}/</span>{{ repository.name }}</a></li>
                            {% endfor %}
                        </ul>
                        <hr class="divider" />
                    </li>
                {% endfor %}
                <li><a href="{% url "front:dashboard:repositories:choose" %}">Manage your subscriptions</a></li>
            </ul>
        </li>
    </ul>
    <ul class="nav repository-views">
        {% for main_view in repository_main_views %}
            {% if main_view.display_in_menu %}
                <li{% if main_view.is_current %} class="active"{% endif %}>
                    <a role="menuitem" href="{{ main_view.url }}{% if main_view.qs %}?{{ main_view.qs }}{% endif %}" title="{{ main_view.title }}">
                        {% if main_view.url_name == 'dashboard' %}
                            <i class="icon-dashboard"> </i>
                        {% elif main_view.url_name == 'issues' %}
                            <i class="icon-sitemap"> </i>
                        {% elif main_view.url_name == 'board' %}
                            <i class="icon-columns"> </i>
                        {% elif main_view.url_name == 'timeline' %}
                            <i class="icon-align-justify"> </i>
                        {% endif %}
                        <span>{{ main_view.title }}</span>
                    </a>
                </li>
        {% endif %}
        {% endfor %}
    </ul>
{% endblock header_nav %}

{% block modal-windows %}
    {{ block.super }}
    {% include "front/modal_issue_view.html" %}
    <div id="go-to-issue-window" class="modal hide" tabindex="-1">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" title="Close" aria-hidden="true">&times;</button>
            <h3>Go to issue</h3>
        </div>
        <div class="modal-body">
            <form class="form-inline">
                <div class="input-prepend input-append">
                    <span class="add-on">#</span>
                    <input type="text" name='number' placeholder="Type an issue number" />
                    <button class="btn btn-blue" type="submit">Go!</button>
                </div>
            </form>
        </div>
    </div>
{% endblock %}