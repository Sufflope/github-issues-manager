{% load static querystring frontutils issues_tags %}
{% for issue in issues %}
    {% block one-issue %}
        <li id="issue-{{ issue.number }}" class="box-section news issue-item{% if current_issue.id == issue.id %} active{% endif %} state-{{ issue.state }}" data-issue-number="{{ issue.number }}">
            <div class="issue-item-header">
                <div class="issue-item-times">
                    <span title="Created on {{ issue.created_at|date:"DATETIME_FORMAT" }}">{{ issue.created_at|ago:True }}</span>
                    {% if issue.state == 'closed' %}
                        {% if issues.updated_at > issue.closed_at %}
                            <i class="icon-caret-right"> </i> <span title="Closed{% if issue.closed_by %} by {{ issue.closed_by.username }}{% endif %} on {{ issue.closed_at|date:"DATETIME_FORMAT" }}, updated on {{ issue.updated_at|date:"DATETIME_FORMAT" }}">{{ issue.updated_at|ago:True }}</span>
                        {% else %}
                            <i class="icon-caret-right"> </i> <span title="Closed{% if issue.closed_by %} by {{ issue.closed_by.username }}{% endif %} on {{ issue.closed_at|date:"DATETIME_FORMAT" }}">{{ issue.closed_at|ago:True }}</span>
                        {% endif %}
                    {% else %}
                        {% if issue.updated_at and issue.created_at != issue.updated_at %}
                            <i class="icon-caret-right"> </i> <span title="Updated on {{ issue.updated_at|date:"DATETIME_FORMAT" }}">{{ issue.updated_at|ago:True }}</span>
                        {% endif %}
                    {% endif %}
                </div>
                {% if issue.is_pull_request %}
                    <div class="issue-item-pull-request">
                        <a href="" title="It's a pull request" class="js-filter-trigger" data-filter='pr:yes'>
                            <i class="icon-upload-alt"> </i>
                        </a>
                    </div>
                {% endif %}
                {% if issue.milestone %}
                    <div class="issue-item-milestone">
                        <a href="" class="js-filter-trigger" data-filter='milestone:{{ issue.milestone.number }}'>
                            <i class="icon-tasks"> </i> {{ issue.milestone.title }}
                        </a>
                    </div>
                {% endif %}
            </div>
            <a href="" title="Created by {{ issue.user.username }}" class="avatar js-filter-trigger" data-filter='created_by:{{ issue.user.username }}'><img class="avatar-small img-circle" src="{{ issue.user.avatar_url }}" alt="{{ issue.user.username }}"></a>
            <div class="news-content">
                <div class="news-title">
                    <a href="{{ issue.get_absolute_url }}{{ issues_filter.querystring_with_user|default:issues_filter.querystring }}#issue-{{ issue.number }}" class="issue-link" data-issue-number="{{ issue.number }}" title="{% if issue.is_pull_request %}Pull-request. {% endif %}State: {{ issue.state }}">
                        <strong>#{{ issue.number }}</strong> - {{ issue.title }}
                    </a>
                </div>
            </div>
            {% with issue_labels=issue.labels.all %}
                <div class="issue-item-footer{% if issue_labels %} with-labels{% endif %}">
                    {% if issue.assignee %}
                            <a href="" title="Assigned to {{ issue.assignee.username }}" class="issue-item-assignee js-filter-trigger" data-filter='assigned:{{ issue.assignee.username }}'><i class="icon-share-alt"> </i><img class="avatar-tiny img-circle" src="{{ issue.assignee.avatar_url }}"></a>
                    {% endif %}
                    {% if issue.comments_count %}
                        <div class="issue-item-comments-count" title="{{ issue.comments_count }} comment{{ issue.comments_count|pluralize }}">
                            <i class="icon-comments-alt"> </i>{{ issue.comments_count }}
                        </div>
                    {% endif %}
                    <div class="issue-item-labels"><!--
                        {% for label in issue_labels %}
                            {% if label.label_type_id %}
                                    {% attributes_for_list label.label_type.labels.all "name" as label_names %}
                                    --><a href="" class="js-filter-trigger" style="border-bottom-color: #{{ label.color }}" data-filter='labels:{{ label.name }}' data-type-name='{{ label.label_type.name }}'>
                                        <strong>{{ label.label_type.name }}:</strong> {{ label.typed_name }}
                                    </a><!--
                            {% endif %}
                        {% endfor %}
                        {% for label in issue_labels %}
                            {% if not label.label_type_id %}
                                    --><a href="" class="js-filter-trigger" style="border-bottom: solid 3px #{{ label.color }}" data-filter='labels:{{ label.name }}'>
                                        {{ label.name }}
                                    </a><!--
                            {% endif %}
                        {% endfor %}
                    --></div>
                </div>
            {% endwith %}
        </li>
    {% endblock one-issue %}
{% endfor %}
